# ContextLinker ç»„ä»¶æ•°æ®è·¯ç”±ç³»ç»Ÿï¼ˆCDRSï¼‰
## åŠ¨æ€ç¼–ç è½¬æ¢ä¸åè®®å¯¹æ¥å±‚

**æ ¸å¿ƒæ¦‚å¿µ**ï¼šæ‰€æœ‰ç»„ä»¶ç¼–ç å®šä¹‰éƒ½æ˜¯**å˜é‡æ˜ å°„**ï¼Œç³»ç»Ÿè‡ªåŠ¨å¤„ç†åè®®è½¬æ¢ä¸è·¯ç”±

---

## ç³»ç»Ÿæ¶æ„æ€»è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ç»„ä»¶æ•°æ®è·¯ç”±ç³»ç»Ÿ (CDRS)                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                    â”‚
â”‚  Layer 1: ç»„ä»¶å®šä¹‰å±‚ (Component Definition Layer)                 â”‚
â”‚  â”œâ”€ ç»„ä»¶åç§°                                                      â”‚
â”‚  â”œâ”€ ç¼–ç æ–¹æ¡ˆåç§° (encoding_scheme)                               â”‚
â”‚  â”œâ”€ ç¼–ç æ€»ä½æ•° (total_bits)                                      â”‚
â”‚  â””â”€ ä¾èµ–ç»„ä»¶åˆ—è¡¨ (dependencies)                                  â”‚
â”‚                                                                    â”‚
â”‚  Layer 2: ç¼–ç å®šä¹‰å±‚ (Encoding Definition Layer)                 â”‚
â”‚  â”œâ”€ ç¼–ç åŒºæ®µåˆ—è¡¨ (segments)                                      â”‚
â”‚  â”‚  â”œâ”€ segment_id (åŒºæ®µå”¯ä¸€æ ‡è¯†)                                â”‚
â”‚  â”‚  â”œâ”€ segment_name (åŒºæ®µåç§°)                                  â”‚
â”‚  â”‚  â”œâ”€ bit_offset (èµ·å§‹ä½ç½®)                                    â”‚
â”‚  â”‚  â”œâ”€ bit_length (åŒºæ®µä½æ•°)                                    â”‚
â”‚  â”‚  â”œâ”€ attribute_definition (å±æ€§å®šä¹‰)                          â”‚
â”‚  â”‚  â””â”€ data_type (int/bytes/float/enum)                        â”‚
â”‚  â””â”€ ç¼–ç ç‰ˆæœ¬æ§åˆ¶ (version, deprecated_at)                       â”‚
â”‚                                                                    â”‚
â”‚  Layer 3: è½¬æ¢è§„åˆ™å±‚ (Conversion Rule Layer)                     â”‚
â”‚  â”œâ”€ ç»„ä»¶é—´è½¬æ¢è§„åˆ™è¡¨ (conversion_matrix)                        â”‚
â”‚  â”œâ”€ ä½æ•°ä¸ä¸€è‡´æ—¶çš„è½¬æ¢ç­–ç•¥                                      â”‚
â”‚  â”œâ”€ å±æ€§ä¸ç›¸å®¹æ—¶çš„æ˜ å°„è§„åˆ™                                      â”‚
â”‚  â””â”€ è½¬æ¢ä¼˜å…ˆçº§ (priority)                                       â”‚
â”‚                                                                    â”‚
â”‚  Layer 4: è·¯ç”±æ‰§è¡Œå±‚ (Routing Execution Layer)                   â”‚
â”‚  â”œâ”€ è·¯ç”±å†³ç­–å¼•æ“ (routing_engine)                               â”‚
â”‚  â”œâ”€ åŠ¨æ€è½¬æ¢å™¨ (dynamic_converter)                              â”‚
â”‚  â”œâ”€ åè®®éªŒè¯å™¨ (protocol_validator)                             â”‚
â”‚  â””â”€ æ•°æ®ç¼“å­˜ (routing_cache)                                    â”‚
â”‚                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸LobsterShellçš„å¯¹åº”å…³ç³»

| CDRSå±‚ | LobsterShellå±‚ | åº”ç”¨åœºæ™¯ |
|--------|---------------|---------|
| Layer 1: ç»„ä»¶å®šä¹‰ | ToolInterface | å·¥å…·å…ƒæ•°æ®å®šä¹‰ |
| Layer 2: ç¼–ç å®šä¹‰ | ToolManifest | å·¥å…·å‚æ•°schema |
| Layer 3: è½¬æ¢è§„åˆ™ | - | æ•°æ®æ ¼å¼è½¬æ¢ |
| Layer 4: è·¯ç”±æ‰§è¡Œ | ToolExecutor | å·¥å…·è°ƒç”¨è·¯ç”± |

---

## æ ¸å¿ƒå®ç°è¦ç‚¹

### 1. ç¼–ç å®šä¹‰å…ƒæ•°æ® (YAML/JSON)
```yaml
component:
  id: "hcda"
  name: "Holographic Character Definition Architecture"
  version: "2.0.1"
  encoding_scheme: "HCDA_v2.0"
  total_bits: 48
  
  segments:
    - segment_id: "lang_id"
      bit_offset: 0
      bit_length: 8
      data_type: "enum"
```

### 2. è½¬æ¢è§„åˆ™é…ç½®
```yaml
conversion_rules:
  - rule_id: "hcda_to_semantic"
    source_component: "hcda"      # 48 bits
    target_component: "semantic"  # 64 bits
    bit_mismatch_strategy: "expand"
    segment_mapping:
      - source_segment: "lang_id"
        target_segment: "lang_id"
        conversion: "direct"
```

### 3. ä½ä¸åŒ¹é…ç­–ç•¥
- **expand**: æ‰©å±•ä½æ•°ï¼ˆ48 â†’ 64ï¼‰
- **truncate**: æˆªæ–­ä½æ•°ï¼ˆ64 â†’ 48ï¼‰
- **map_partial**: éƒ¨åˆ†æ˜ å°„ï¼ˆ192 â†’ 256ï¼‰

---

## åŠ¨æ€è·¯ç”±å¼•æ“

```python
class RoutingEngine:
    """ä¸»è·¯ç”±å¼•æ“"""
    
    def route_and_convert(self, data: bytes,
                         source_component: str,
                         target_component: str) -> bytes:
        """è·¯ç”±å¹¶è½¬æ¢æ•°æ®"""
        
        # 1. æŸ¥æ‰¾è½¬æ¢è§„åˆ™ï¼ˆç›´æ¥æˆ–è·¯å¾„ï¼‰
        # 2. åº”ç”¨è½¬æ¢è§„åˆ™
        # 3. ç¼“å­˜è·¯å¾„
        # 4. è¿”å›è½¬æ¢ç»“æœ
```

---

## ç³»ç»Ÿä¼˜åŠ¿

âœ… **å®Œå…¨å˜é‡é‡åŒ–**ï¼šæ‰€æœ‰ç¼–ç å®šä¹‰éƒ½æ˜¯é…ç½®ï¼Œä¸ç”¨æ”¹ä»£ç 
âœ… **åŠ¨æ€è·¯ç”±**ï¼šè‡ªåŠ¨å¯»æ‰¾æœ€ä¼˜è½¬æ¢è·¯å¾„
âœ… **å³æ—¶éªŒè¯**ï¼šè½¬æ¢å‰éªŒè¯åè®®ç›¸å®¹æ€§
âœ… **æ˜“äºæ‰©å±•**ï¼šæ·»åŠ æ–°ç»„ä»¶åªéœ€æ–°å¢é…ç½®æ–‡ä»¶
âœ… **è‡ªåŠ¨ç¼“å­˜**ï¼šè½¬æ¢è·¯å¾„è‡ªåŠ¨ç¼“å­˜ï¼Œæ€§èƒ½ä¼˜åŒ–
âœ… **å‘ä¸‹å…¼å®¹**ï¼šæ—§ç¼–ç ç‰ˆæœ¬å¯ä¸æ–°ç‰ˆæœ¬å…±å­˜
âœ… **æ— ä¸­æ–­è¿ç§»**ï¼šæ”¹ä½æ•°åªéœ€æ›´æ–°é…ç½®ï¼Œé›¶åœæœº

---

## LobsterShellåº”ç”¨

### å·¥å…·å‚æ•°è½¬æ¢
```yaml
conversion_rules:
  - rule_id: "tool_input_to_sql"
    source_component: "tool_input"    # JSON
    target_component: "sql_query"     # SQL
    bit_mismatch_strategy: "map_partial"
    
    segment_mapping:
      - source_segment: "query_params"
        target_segment: "where_clause"
        conversion: "json_to_sql"
```

### å®¡è®¡æ—¥å¿—ç¼–ç 
```yaml
component:
  id: "audit_log"
  total_bits: 256
  
  segments:
    - segment_id: "timestamp"
      bit_offset: 0
      bit_length: 64
      
    - segment_id: "tool_id"
      bit_offset: 64
      bit_length: 32
      
    - segment_id: "user_id"
      bit_offset: 96
      bit_length: 32
```

---

## é…ç½®æ–‡ä»¶ç»“æ„

```
config/
â”œâ”€â”€ routing_config.yaml          # å…¨å±€è·¯ç”±é…ç½®
â”‚
encodings/
â”œâ”€â”€ hcda_component.yaml          # HCDA ç¼–ç å®šä¹‰
â”œâ”€â”€ istid_component.yaml         # ISTID ç¼–ç å®šä¹‰
â”œâ”€â”€ tool_input_component.yaml    # å·¥å…·è¾“å…¥ç¼–ç 
â””â”€â”€ audit_log_component.yaml     # å®¡è®¡æ—¥å¿—ç¼–ç 
```

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### Phase 1: é…ç½®é©±åŠ¨åŒ–
- [ ] ä¸ºæ¯ä¸ªå·¥å…·å†™ `*_component.yaml`
- [ ] å†™ `routing_config.yaml` å®šä¹‰è½¬æ¢è§„åˆ™
- [ ] å®ç° EncodingDefinitionLoader
- [ ] å®ç° ConversionRuleManager

### Phase 2: è·¯ç”±æ‰§è¡ŒåŒ–
- [ ] å®ç° DynamicConverter
- [ ] å®ç° RoutingEngine
- [ ] æµ‹è¯•æ‰€æœ‰è½¬æ¢è·¯å¾„

### Phase 3: è¿è¡Œæ—¶åŠ¨æ€åŒ–
- [ ] å®ç°åŠ¨æ€é…ç½®æ›´æ–°
- [ ] æ”¯æŒè¿è¡Œæ—¶æ·»åŠ è½¬æ¢è§„åˆ™

---

*ä¿å­˜è€…: å°æ©™ ğŸŠ*  
*ä¿å­˜æ—¶é—´: 2026-02-17*
